/*
 *  x-tree-select - v1.3.0
 *  Tree select for jquery.
 *  
 *
 *  Made by 4xmen
 *  Under GPL-3.0 License
 */
!function(a){"use strict";a.fn.treeSelect=function(b){a.treeselect_animation={none:"","x-flip":"anim xout",fade:"xfade",slide:"xslide"},void 0===a.trsStore&&(a.scbCounter=-1,a.trsStore=[],a.currentCounter=0),a.trs=this;var c=a.extend({datatree:[],transition:"fade",direction:"ltr",onOpen:function(){},OnSelect:function(a){},OnChange:function(a,b){},onClose:function(){},selectablePrernt:!1,mainTitle:"Main category",json:{title:"title",value:"value",child:"child"}},b);return a.navigatex=[],a.lastx={title:"",id:""},this.target=null,this.text=null,a.scbCounter++,a.trsStore[a.scbCounter]=c,this.init=function(b){a.lastx.title=c.mainTitle,a(b).hide();var d="Please select";void 0!==a(b).attr("placeholder")&&(d=a(b).attr("placeholder"));var e="";"rtl"===a.trsStore[a.scbCounter].direction&&(e="trs-rtl"),a(b).parent().append('<div class="trsel '+e+'" data-trcounter="'+a.scbCounter+'" >'+d+"</div>"),c.datatree=a.trs.makeId("1",c.datatree),a(b).parent().find(".trsel").bind("click.open",function(c){if(c.target===this)if(a.currentCounter=a(this).data("trcounter"),a.lastx.title=a.trsStore[a.currentCounter].mainTitle,a(this).hasClass("active")){if(c.target!==this)return;a(this).removeClass("active"),a("#trsel-list").slideUp(100,function(){a(this).remove()})}else a.trsStore[a.currentCounter].onOpen(),a.trs.target=a(this).parent().find("input"),a.trs.text=a(b).parent().find(".trsel"),a(this).append('<ul id="trsel-list"></ul>'),void 0===a.trsStore[a.currentCounter].navx?a.trs.showTree(a.trsStore[a.currentCounter].datatree):(a.lastx=a.trsStore[a.currentCounter].lastx,a.navigatex=a.trsStore[a.currentCounter].navx,a.trs.showTree(a.trs.findTree(a.trsStore[a.currentCounter].datatree,a.trsStore[a.currentCounter].lastx.id))),a("#trsel-list").slideDown(function(){a(document).bind("click.handvarrsl",function(b){return a(b.target).is(".trsel-childer, .trsel-back")||(a.trs.resetClose(),a("#trsel-list").slideUp(200,function(){a(this).remove()}),a(a.trs.text).removeClass("active")),b.preventDefault(),!1})}),a(this).addClass("active")}),a(document).off("click","#trsel-list li"),a(document).on("click","#trsel-list li",function(b){if(a(this).hasClass("trsel-childer")&&!a(b.target).hasClass("trsel-selectable")){var c={title:a.lastx.title,id:a.lastx.id};a.navigatex.push(c),a.lastx.title=a(this).text(),a.lastx.id=a(this).data("id"),a("#trsel-list").addClass(a.treeselect_animation[a.trsStore[a.currentCounter].transition]);var d=this;setTimeout(function(){a.trs.showTree(a.trs.findTree(a.trsStore[a.currentCounter].datatree,a(d).data("id"))),a("#trsel-list").removeClass(a.treeselect_animation[a.trsStore[a.currentCounter].transition])},600)}else if(a(this).hasClass("trsel-back")){void 0!==a.navigatex[a.navigatex.length-1]?(a.lastx.title=a.navigatex[a.navigatex.length-1].title,a.lastx.id=a.navigatex[a.navigatex.length-1].id):(a.lastx.title=a.trsStore[a.currentCounter].mainTitle,a.lastx.id=""),a.navigatex.pop();var e=a.trs.findTree(a.trsStore[a.currentCounter].datatree,a(this).data("id"));a("#trsel-list").addClass(a.treeselect_animation[a.trsStore[a.currentCounter].transition]);setTimeout(function(){0===e.length?a.trs.showTree(a.trsStore[a.currentCounter].datatree):a.trs.showTree(e),a("#trsel-list").removeClass(a.treeselect_animation[a.trsStore[a.currentCounter].transition])},600)}else a.trsStore[a.currentCounter].OnChange({value:a(a.trs.target).val(),text:a(a.trs.text).clone().children().remove().end().text()},{value:a(this).data("value"),text:a(this).text()}),a(a.trs.target).val(a(this).data("value")),a(a.trs.text).text(a(this).text()),a.navigatex.length>0?(a.trsStore[a.currentCounter].navx=a.navigatex,a.trsStore[a.currentCounter].lastx=a.lastx):(delete a.trsStore[a.currentCounter].navx,delete a.trsStore[a.currentCounter].lastx),a(a.trs.text).removeClass("active"),a.trsStore[a.currentCounter].OnSelect({value:a(this).data("value"),text:a(this).text()}),a("#trsel-list").slideUp(100,function(){a(this).remove()})})},this.makeId=function(b,c){var d=[];for(var e in c){var f=c[e],g=b+"-"+(parseInt(e)+1);f.idx=g,void 0===f[a.trsStore[a.scbCounter].json.child]&&(f[a.trsStore[a.scbCounter].json.child]=[]),0!==f[a.trsStore[a.scbCounter].json.child].length&&(f[a.trsStore[a.scbCounter].json.child]=a.trs.makeId(g,f[a.trsStore[a.scbCounter].json.child])),d.push(f)}return d},this.showTree=function(b,c){var d="";if(a("#trsel-list li").remove(),0!==a.navigatex.length){var e=a.navigatex[a.navigatex.length-1];d+='<li class="trsel-back" data-id="'+e.id+'"> &nbsp;'+e.title+"</li>"}for(var f in b){var g=b[f],h=' class="trsel-childer"',i="";if(0===g[a.trsStore[a.currentCounter].json.child].length)h=' class=""';else if(a.trsStore[a.currentCounter].selectablePrernt)var i='<span class="trsel-selectable"></span>';d+="<li"+h+' data-id="'+g.idx+'"  data-value="'+g[a.trsStore[a.currentCounter].json.value]+'">'+i+g[a.trsStore[a.currentCounter].json.title]+"</li>"}a("#trsel-list").html(d),void 0!==c&&c()},this.findTree=function(b,c){var d=[];for(var e in b){var f=b[e];if(f.idx===c)return f[a.trsStore[a.currentCounter].json.child]}for(var e in b){var f=b[e];if(0!==f[a.trsStore[a.currentCounter].json.child].length){var g=a.trs.findTree(f[a.trsStore[a.currentCounter].json.child],c);if(0!==g.length)return g}}return d},this.resetClose=function(){a.trsStore[a.currentCounter].onClose(),a.navigatex=[],a.lastx={title:a.trsStore[a.currentCounter].mainTitle,id:""},a(document).unbind("click.handvarrsl")},this.setValue=function(a){var b=this.html();this.html(b+" "+a)},this.each(function(){a.trs.init(this)}),this}}(jQuery);